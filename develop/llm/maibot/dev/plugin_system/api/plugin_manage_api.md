---\ntitle: 插件管理 API\nlast_updated: 2026-01-19\n---\n\n## 概述\n\n插件管理 API 提供了对 MaiBot 插件生命周期的核心控制功能。通过该模块，开发者可以查询已注册或已加载的插件列表、获取插件物理路径、动态加载/卸载/重载插件，以及管理插件扫描目录。\n\n## API 列表\n\n### 1. 查询类接口\n\n- **list_loaded_plugins() -> List[str]**\n  列出当前所有已成功加载到系统中的插件名称。\n\n- **list_registered_plugins() -> List[str]**\n  列出所有已在系统中注册（但不一定已加载）的插件名称。\n\n- **get_plugin_path(plugin_name: str) -> str**\n  获取指定插件的绝对路径。若插件不存在，将抛出 `ValueError`。\n\n### 2. 生命周期管理接口\n\n- **async remove_plugin(plugin_name: str) -> bool**\n  异步卸载指定的插件。返回卸载是否成功的布尔值。\n\n- **async reload_plugin(plugin_name: str) -> bool**\n  异步重新加载指定的插件。返回重载是否成功的布尔值。\n\n- **load_plugin(plugin_name: str) -> Tuple[bool, int]**\n  加载指定的插件。返回一个元组，包含加载是否成功的状态及受影响的插件/类数量。\n\n### 3. 目录管理接口\n\n- **add_plugin_directory(plugin_directory: str) -> bool**\n  向系统添加新的插件扫描目录。\n\n- **rescan_plugin_directory() -> Tuple[int, int]**\n  重新扫描已配置的插件目录以发现并加载新插件。返回成功与失败的计数元组。\n\n## 调用约定\n\n1. **异步要求**：`remove_plugin` 和 `reload_plugin` 是异步函数，必须在异步上下文（如 `await`）中使用。\n2. **异常处理**：调用 `get_plugin_path` 时应处理 `ValueError`，以防插件名称无效。\n3. **内部依赖**：该 API 模块高度依赖 `src.plugin_system.core.plugin_manager` 实例。\n\n## 变更影响分析\n\n- **核心耦合**：此 API 是对底层 `plugin_manager` 的直接封装。如果 `plugin_manager` 的内部方法签名发生变化，此模块需同步更新。\n- **动态性**：支持运行时动态增删插件，但需注意异步操作可能带来的竞态条件。\n\n## 证据\n\n- 源码文件：`src/plugin_system/apis/plugin_manage_api.py`\n- 异步定义：`async def remove_plugin(plugin_name: str) -> bool:`\n- 列表查询：`def list_loaded_plugins() -> List[str]:`\n- 异常逻辑：`raise ValueError(f\"插件 '{plugin_name}' 不存在。\")`