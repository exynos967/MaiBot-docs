---\ntitle: 维护工具与 LPMM 管理脚本\nlast_updated: 2026-01-19\n---\n\n## 概述\nMaiBot 项目的工具脚本集（位于 `scripts` 目录）涵盖了 LPMM (Long-term Personal Memory Module) 知识库的全生命周期管理、表情包打包工具 (.mmipkg) 以及对话语料分析与评估系统。这些脚本主要用于自动化处理原始数据并维护核心知识库。\n\n## 目录/结构\n- `scripts/lpmm_manager.py`: LPMM 知识库管理的统一调度入口，整合了预处理、抽取、导入、删除和检索测试等功能，包含 `run_action` 调度逻辑。\n- `scripts/mmipkg_tool.py`: `MMIPKGPacker` 类负责表情包的打包、zstd 压缩以及图片重新编码（支持 WebP/JPEG/PNG）。\n- `scripts/info_extraction.py`: 负责信息提取任务，支持多线程处理，提取结果输出至 `OPENIE_OUTPUT_DIR`。\n- `scripts/raw_data_preprocessor.py`: 提供 `load_raw_data` 接口，负责按空行分段语料并进行 SHA256 去重。\n- `scripts/delete_lpmm_items.py`: 专门用于删除 LPMM 知识项的工具，设有单次 2000 节点的删除上限保护。\n\n## 适用范围\n本手册适用于运维及开发人员执行以下任务：\n1. LPMM 知识库的导入、删除与自检（如 `inspect_lpmm_batch.py`）。\n2. 原始语料的预处理与 OpenIE 结构化数据构建。\n3. 表情包资源的注册与打包维护。\n4. 通过 LLM 对回复表达风格进行准确率评估（`evaluate_expressions_llm_v6.py`）。\n\n## 变更影响分析\n- **资源消耗**: 大批量执行 `info_extraction.py` 时可能产生显著的 API 费用，需监控 `info_extraction_workers` 配置。\n- **并发安全**: 脚本在操作 `TEMP_DIR` 下的临时文件时通过锁机制保护，防止并发写入冲突。\n- **风险控制**: 为防止误操作，`delete_lpmm_items.py` 严格限制了单次删除的节点数量。\n- **依赖项**: 运行此类脚本需安装 `msgpack`, `zstandard`, `Pillow`, `rich` 等依赖。\n\n## 证据\n- scripts/lpmm_manager.py\n- scripts/mmipkg_tool.py\n- scripts/info_extraction.py